# Activity Summary for 10/31/2025

## 8:09:18 AM

The provided log details changes to a single Bazel `BUILD` file, specifically located at `/Users/mmuruts/projects/tink/api-docs/docs/BUILD`. This file, last updated on 10/30/2025 at 8:59:23 AM, is responsible for building, testing, and deploying API documentation for the Tink project.

Key information from this change includes:

*   **Bazel Build Configuration:** The file heavily leverages Bazel rules for Go (`go_library`, `go_test`) and Docker (`container_layer`, `container_image`, `container_push`). It defines a Go library from `merge.go` and a corresponding test file, likely for processing or merging API specifications.
*   **API Documentation Aggregation:** A central feature is the `container_layer` named `swagger`. This layer explicitly bundles a large number of Swagger/OpenAPI definition files (`.swagger` or `_fixed_swagger`) from various gRPC services and backend components. This indicates a robust system for collecting and consolidating API documentation from disparate services within the Tink ecosystem. Recurring patterns like `@com_tink_api_grpc//...` and `@se_tink_backend//...` point to automated generation and inclusion of these specifications.
*   **Docker Image Creation:** An `api-docs` Docker image is configured (`container_image` name `image`). This image is based on `debian-debootstrap`, uses an `entrypoint.sh` script, includes a compiled `merge` command, and crucially, incorporates the `swagger` layer containing all the aggregated API definitions. This suggests the merged documentation is intended to be served via this Docker container.
*   **Deployment to AWS ECR:** The `container_push` rule specifies deployment of the `api-docs` image to an AWS ECR registry (`784217881480.dkr.ecr.eu-west-1.amazonaws.com/api-docs`), tagged with `{GATEWAY_VERSION}`. This indicates an automated pipeline for publishing the compiled API documentation.

In summary, this change represents an update to the CI/CD pipeline for Tink's API documentation, focusing on automatically gathering numerous Swagger definitions from various services, merging them, packaging them into a Docker image, and pushing this image to AWS ECR for deployment, presumably to serve as a central API reference.

## 8:25:09 AM
The provided log primarily tracks a single file: `/Users/mmuruts/projects/tink/tink-backend/README.md`.

**File-Specific Updates:**
Despite being logged multiple times between 8:41:56 AM and 8:52:56 AM on October 30, 2025, the content of the `README.md` file remained entirely unchanged across all entries. Each log entry presents the exact same comprehensive documentation.

**Timestamps of Significant Changes:**
There are no significant changes in the content to highlight at specific timestamps, as the file's content is identical across all logged versions.

**Patterns or Recurring Elements in Content:**
The content consistently details the structure and development guidelines for the `tink-backend` repository. Key recurring themes and elements within this `README.md` include:
*   **Overview:** Describes the repository as containing source code for many backend services at Tink, with links to related repositories.
*   **Table of READMEs:** A prominent section listing various specific README files covering aspects like contributing, Bazel, beginner guidance, code ownership, transaction rules, Git, Kafka, keystore management, database migrations, translations, and troubleshooting.
*   **Getting Started:** A detailed guide for new developers, emphasizing reading the `README_BEGINNER.md`.
*   **Setup and Running:** Extensive instructions for getting services up and running, which consistently involve:
    *   **Bazel:** All services are built with Bazel, with instructions for installation on macOS (including M1 specifics) and Linux.
    *   **Minikube:** Services run infrastructure dependencies inside Minikube, with setup steps and driver installation guides for macOS (Docker, HyperKit, VirtualBox) and Linux (KVM2, VirtualBox).
    *   **Prerequisites:** Common dependencies like Git, minikube, kubernetes-cli, gettext, Go, Java (OpenJDK 8 & 11), Docker, Google Cloud SDK are consistently mentioned.
    *   **Authentication:** Steps for authenticating to ECR and Tink's jFrog.
    *   **Development Workflow:** Commands for starting minikube services, running `kubectl` to check pods, building services with Bazel, and setting up GitHub Packages.
*   **Development Guidelines:** Sections on "Coding guidelines" (referencing `CONTRIBUTING.md`) and "Working with Bazel" (referencing `README_BAZEL.md`).
*   **Bazel Usage:** Detailed instructions for building services, running unit tests (including filtering and debug modes), and executing binaries, with specific Bazel commands.
*   **Go Programming:** Guidelines for Go development, including using standard Go workflow or Bazel, a single `go.mod` file, `BUILD` files generated by Gazelle, and requirements for new Go projects (listing in `gazelle-external`, Docker build rule, `catalog-info.yaml` registration).
*   **Dependency Management:** Highlighted use of Bazel with Gazelle for Go modules.

In summary, the log entries indicate monitoring or repetitive saving of the `README.md` file, which serves as a central hub for development information, setup instructions, and best practices within the `tink-backend` project.

## 8:25:22 AM
The changes primarily introduce and integrate a new data source, Cassandra V1, into the existing transaction service's internal gRPC API, specifically for transaction retrieval operations. This integration is controlled by a feature flag.

**File-Specific Updates:**

*   **/Users/mmuruts/projects/tink/transaction-service/internal/grpc/internal_server.go (10/29/2025, 9:04:34 PM and 9:04:54 PM):**
    *   **New Cassandra V1 Read Path:** Significant additions to handle fetching and listing transactions directly from Cassandra V1.
    *   **Feature Flag Control:** The `GetTransaction` and `ListTransactions` gRPC methods now check a `readCassandraV1AsV2` flag (presumably controlled by a feature toggle) to route requests to either new Cassandra-backed implementations (`getTransactionFromCassandra`, `listTransactionsFromCassandra`) or existing Elasticsearch-backed ones (`getTransactionFromElasticsearch`, `listTransactionsFromElasticsearch`).
    *   **Cursor-Based Pagination:** A new `PaginationCursor` struct and supporting logic (`decodeCursor`, `encodeCursor`, `calculatePeriodsFromDateRange`, `fetchTransactionsWithCursor`) have been introduced for efficient cursor-based pagination when querying Cassandra.
    *   **Cassandra Repository Interface:** A `cassandraRepository` interface with methods like `GetTransactionsByUserIDAndIDsWithPeriods` and `FindByUserIDAndPeriodWithCursor` is defined, abstracting Cassandra interactions.
    *   **Data Conversion:** Logic for converting Cassandra V1 transaction formats to V2 internal formats (`cassandra.FromCassandraV1ToV2Internal`) is included.
    *   **Tracing and Error Handling:** Datadog tracing spans are added, and robust error handling is implemented for various failure scenarios (e.g., missing user/transaction IDs, transaction not found).
    *   The second timestamp for this file (9:04:54 PM) appears to be a minor completion or correction of the `ListTransactions` function body, which was truncated in the previous entry, making the code fully functional as intended.

*   **/Users/mmuruts/projects/tink/transaction-service/internal/grpc/internal_server_test.go (10/29/2025, 9:32:11 PM):**
    *   **Mock Cassandra Repository:** A `mockCassandraRepo` is introduced to simulate Cassandra database behavior for testing purposes, implementing the `cassandraRepository` interface.
    *   **Extensive New Tests:** New test suites, `Test_GetTransaction` and `Test_ListTransactions`, are added to cover the Cassandra-backed transaction retrieval logic.
    *   **Feature Toggle Testing:** These tests explicitly enable the `fetch-v1-from-cassandra-for-v2` feature toggle using `featuretoggle.InitFake()` to ensure the Cassandra read path is exercised.
    *   **Test Cases:** Tests cover successful retrieval, validation errors (missing user/transaction IDs), and "not found" scenarios for both single transaction retrieval and listing operations.

*   **/Users/mmuruts/projects/tink/transaction-service/internal/featuretoggle/feature_toggle.go (10/29/2025, 9:43:03 PM):**
    *   **New Feature Flag Definition:** A new feature toggle, `FetchV1FromCassandraForV2Toggle`, is added. Its `IsEnabled()` method checks the "fetch-v1-from-cassandra-for-v2" flag in the Unleash feature toggle system, using the `clusterName` context. This formally introduces the control mechanism for the Cassandra V1 read path.

**Patterns and Recurring Elements:**

*   **Feature Flag-Driven Migration/Dual-Read:** A consistent pattern across the codebase is the use of the "fetch-v1-from-cassandra-for-v2" feature toggle. This strongly indicates a strategy to either migrate from Elasticsearch to Cassandra V1 for certain transaction data or to enable a dual-read capability for the internal V2 API, allowing controlled rollout and testing.
*   **"GENAI" Markers:** The `/* START GENAI */` and `/* END GENAI */` comments appear consistently in `internal_server.go` and `internal_server_test.go`, marking significant blocks of newly added or modified code related to this initiative.
*   **Architectural Segregation:** The service is designed to separate concerns by delegating to specific functions (`getTransactionFromCassandra`/`getTransactionFromElasticsearch`, etc.) based on the feature flag, maintaining a clean entry point for gRPC requests.
*   **Emphasis on Pagination:** The detailed implementation of cursor-based pagination for Cassandra suggests an expectation of large datasets and a focus on performance and scalability for transaction listings.
*   **Traceability and Observability:** The integration of Datadog tracing (`tracer.StartSpanFromContext`) points to an emphasis on monitoring and understanding the performance characteristics of the new Cassandra data path.

## 9:09:17 AM
The provided log details changes to a single Bazel `BUILD` file, located at `/Users/mmuruts/projects/tink/api-docs/docs/BUILD`, with a timestamp of **10/30/2025, 8:59:23 AM**.

**File-Specific Updates for `/Users/mmuruts/projects/tink/api-docs/docs/BUILD`:**

The `BUILD` file orchestrates the generation and deployment of API documentation. Key updates and configurations include:

*   **Bazel Rule Loading:** It loads various Bazel rules for Go (`go_library`, `go_test`), Gazelle (`gazelle`), and Docker (`go_image`, `container_run_and_commit`, `container_image`, `container_layer`, `container_push`).
*   **Go Library and Testing:**
    *   A `go_library` named `go_default_library` is defined, using `merge.go` as its source, indicating a Go application responsible for merging API specifications. It depends on `go_openapi_loads` and `go_openapi_spec`.
    *   A corresponding `go_test` named `go_default_test` is set up for `merge_test.go`, including test data and using `stretchr_testify/assert`.
*   **Swagger/OpenAPI Aggregation (`container_layer`):**
    *   A significant `container_layer` named `swagger` is defined. This layer aggregates a substantial number of Swagger/OpenAPI definition files from various gRPC services and backend modules.
    *   These definitions originate from `@com_tink_api_grpc` (e.g., `authentication_configuration_service`, `tink/income_checks/v2`, `tink/risk_insights`, `tink/expense_checks/v1`, `tink/merchants/v1`, `tink/settlement_accounts/v1`, `tink/bulk_payments/v1`, `tink/golden_receiver`, `tink/transaction_history`) and `@se_tink_backend` (e.g., `budgets-bfm/api`, `cash-flow/api/proto`, `financial-calendar/api/proto`, `link/proto/session/v1`, `account/account-proxy/proxy/proto/v2`).
    *   This indicates a centralized process for collecting API documentation from a wide array of microservices and backend components.
*   **Docker Image Creation and Push:**
    *   A `container_image` named `image` is built using a Debian base (`@debian-debootstrap//image`). It includes an `entrypoint.sh` script and the compiled Go binary from `//docs/cmd/merge`, and critically incorporates the `:swagger` layer.
    *   A `container_push` rule named `docker_push` is configured to push this image to an AWS ECR registry (`784217881480.dkr.ecr.eu-west-1.amazonaws.com`) under the `api-docs` repository, tagged with a `{GATEWAY_VERSION}` placeholder.

**Patterns and Recurring Elements:**

The most prominent pattern is the extensive list of individual Swagger/OpenAPI definitions being compiled into a single `swagger` container layer. This clearly suggests an architecture where numerous microservices contribute their API specifications, which are then collected and potentially merged or packaged together for an API Gateway or consolidated documentation portal. The naming conventions (e.g., `_swagger`, `_fixed_swagger`) are consistent across various services, indicating a standardized approach to API definition generation within the organization.